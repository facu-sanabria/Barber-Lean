<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Turnos Peluquer√≠a</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .day.active { background-color:#F3F4F6; border-color:#6366F1; }
    .day.disabled { background-color:#E5E7EB; color:#9CA3AF; cursor:not-allowed; opacity:.9 }
    .time-slot.available { background-color:#EFF6FF; color:#2563EB; cursor:pointer; }
    .time-slot.available:hover { background-color:#DBEAFE; }
    .time-slot.booked { background-color:#FEE2E2; color:#DC2626; cursor:not-allowed; }
    .time-slot.selected { background-color:#6366F1; color:#fff; }
    .btn-disabled { opacity:.5; cursor:not-allowed; }
    .time-slot.past { background-color:#F3F4F6; color:#9CA3AF; cursor:not-allowed; }
    .day .chip-hoy{ position:absolute; top:6px; left:6px; font-size:10px; background:#fff; border:1px solid #E5E7EB; padding:2px 6px; border-radius:9999px; }
    #confirmation { transition: all .3s ease; }
    
    /* Agregando estilos para el banner hero y animaciones */
    .hero-banner {
      background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
      position: relative;
      overflow: hidden;
    }
    
    .hero-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
    }
    
    .floating-icon {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .fade-in {
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <!-- Banner hero con gradiente y elementos decorativos -->
  <div class="hero-banner text-white py-16 mb-8 relative">
    <div class="container mx-auto px-4 max-w-4xl relative z-10">
      <div class="text-center">
        <!-- Logo flotante con animaci√≥n -->
        <div class="floating-icon mb-6">
          <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl border border-white/30">
            <span class="text-4xl">üíà</span>
          </div>
        </div>
        
        <!-- T√≠tulo principal con efecto fade-in -->
        <div class="fade-in">
          <h1 class="text-5xl md:text-6xl font-bold mb-4 tracking-tight">
            Barber√≠a <span class="text-blue-300">Lean</span>
          </h1>
          <p class="text-xl md:text-2xl font-light mb-2 text-white/90">
            Estilo y elegancia en cada corte
          </p>
          <div class="w-24 h-1 bg-blue-400 mx-auto rounded-full mb-6"></div>
          <p class="text-lg text-white/80 max-w-2xl mx-auto leading-relaxed">
            Reserva tu turno de forma r√°pida y sencilla. Selecciona el d√≠a y horario que mejor se adapte a tu agenda.
          </p>
        </div>
      </div>
    </div>
    
    <!-- Elementos decorativos -->
    <div class="absolute top-10 left-10 w-32 h-32 bg-white/5 rounded-full blur-xl"></div>
    <div class="absolute bottom-10 right-10 w-40 h-40 bg-blue-400/10 rounded-full blur-2xl"></div>
  </div>

  <div class="container mx-auto px-4 pb-8 max-w-4xl">
    <!-- Secci√≥n de informaci√≥n del cliente con dise√±o glass -->
    <div class="glass-card rounded-2xl p-8 mb-8 shadow-xl">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-gradient-to-r from-slate-600 to-slate-700 rounded-lg flex items-center justify-center">
          <span class="text-white text-sm">üë§</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-800">Informaci√≥n personal</h3>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
          <input id="nombre" type="text" placeholder="Tu nombre" 
                 class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300">
        </div>
        <div class="space-y-2">
          <label for="apellido" class="block text-sm font-medium text-gray-700">Apellido</label>
          <input id="apellido" type="text" placeholder="Tu apellido" 
                 class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300">
        </div>
      </div>
    </div>
          
    <!-- Calendario con dise√±o mejorado -->
    <div class="glass-card rounded-2xl p-8 mb-8 shadow-xl">
      <div class="flex items-center gap-3 mb-8">
        <div class="w-8 h-8 bg-gradient-to-r from-slate-600 to-slate-700 rounded-lg flex items-center justify-center">
          <span class="text-white text-sm">üìÖ</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-800">Selecciona fecha y horario</h3>
      </div>
      
      <div class="mb-6 grid grid-cols-1 sm:grid-cols-3 items-center gap-4">
        <button id="prev-week"
          class="w-full px-4 py-3 bg-gradient-to-r from-gray-100 to-gray-200 rounded-xl hover:from-gray-200 hover:to-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base font-medium transition-all duration-200">
          <span class="sm:hidden">‚Üê Anterior</span>
          <span class="hidden sm:inline">‚Üê Semana anterior</span>
        </button>
    
        <div class="text-center">
          <span id="week-range" class="text-base sm:text-lg font-semibold text-gray-800 leading-tight break-words"></span>
        </div>
    
        <button id="next-week"
          class="w-full px-4 py-3 bg-gradient-to-r from-gray-100 to-gray-200 rounded-xl hover:from-gray-200 hover:to-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base font-medium transition-all duration-200">
          <span class="sm:hidden">Siguiente ‚Üí</span>
          <span class="hidden sm:inline">Semana siguiente ‚Üí</span>
        </button>
      </div>
    
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-3 mb-8">
        <!-- Los d√≠as se generan con JS -->
      </div>

      <div id="time-slots-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
        <!-- Los horarios se generan con JS -->
      </div>
    </div>

    <!-- Secci√≥n de confirmaci√≥n con dise√±o mejorado -->
    <div id="confirmation" class="glass-card rounded-2xl p-8 opacity-0 invisible h-0 overflow-hidden transition-all duration-300 shadow-xl">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-gradient-to-r from-slate-600 to-slate-700 rounded-lg flex items-center justify-center">
          <span class="text-white text-sm">‚úì</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-800">Confirma tu turno</h3>
      </div>
      
      <div class="bg-gray-50 rounded-xl p-6 mb-6 space-y-3">
        <p class="text-gray-700 flex justify-between">
          <span class="font-medium">Nombre:</span> 
          <span id="confirm-name" class="text-gray-900"></span>
        </p>
        <p class="text-gray-700 flex justify-between">
          <span class="font-medium">Fecha:</span> 
          <span id="confirm-date" class="text-gray-900"></span>
        </p>
        <p class="text-gray-700 flex justify-between">
          <span class="font-medium">Horario:</span> 
          <span id="confirm-time" class="text-gray-900"></span>
        </p>
      </div>
      
      <div class="flex justify-end">
        <button id="confirm-btn" 
                class="px-8 py-3 bg-gradient-to-r from-slate-700 to-slate-800 text-white rounded-xl hover:from-slate-800 hover:to-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-500 font-medium transition-all duration-200 shadow-lg">
          Reservar turno
        </button>
      </div>
    </div>

    <!-- Mensaje de √©xito mejorado -->
    <div id="success-message" class="hidden bg-gradient-to-r from-green-100 to-emerald-100 border-2 border-green-300 text-green-800 px-6 py-4 rounded-xl relative mb-4 shadow-lg">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üéâ</span>
        <div>
          <strong class="font-bold text-lg">¬°Turno reservado con √©xito!</strong>
          <p class="text-sm text-green-700 mt-1">Te esperamos en la fecha y horario seleccionados.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript sin cambios -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {

      let currentWeek = 0;
      let selectedDay = null;
      let selectedTime = null;

      const daysContainer = document.querySelector('.grid-cols-1.sm\\:grid-cols-2.md\\:grid-cols-3.lg\\:grid-cols-7');
      const timeSlotsContainer = document.getElementById('time-slots-container');
      const weekRangeElement = document.getElementById('week-range');
      const prevWeekBtn = document.getElementById('prev-week');
      const nextWeekBtn = document.getElementById('next-week');
      const nombreInput = document.getElementById('nombre');
      const apellidoInput = document.getElementById('apellido');
      const confirmationSection = document.getElementById('confirmation');
      const confirmNameElement = document.getElementById('confirm-name');
      const confirmDateElement = document.getElementById('confirm-date');
      const confirmTimeElement = document.getElementById('confirm-time');
      const confirmBtn = document.getElementById('confirm-btn');
      const successMessage = document.getElementById('success-message');

      function isSameDay(d1, d2) {
        return d1.getFullYear() === d2.getFullYear() &&
               d1.getMonth() === d2.getMonth() &&
               d1.getDate() === d2.getDate();
      }
      function isToday(date) {
        const t = new Date(); t.setHours(0,0,0,0);
        const d = new Date(date); d.setHours(0,0,0,0);
        return t.getTime() === d.getTime();
      }

      function generateWeekDays() {
        daysContainer.innerHTML = '';

        const today = new Date();
        today.setHours(0,0,0,0);

        const startDate = new Date(today);
        startDate.setDate(today.getDate() + (currentWeek * 7));
        while (startDate.getDay() !== 1) { // lunes
          startDate.setDate(startDate.getDate() - 1);
        }

        const days = [];
        for (let i=0; i<7; i++) {
          const d = new Date(startDate);
          d.setDate(startDate.getDate() + i);
          days.push(d);
        }

        const start = days[0];
        const end = days[6];
        weekRangeElement.textContent = `${formatDate(start)} - ${formatDate(end)}`;

        days.forEach(day => {
          const dayEl = document.createElement('div');
          dayEl.className = 'day p-3 border rounded-md text-center';

          const isSunday = day.getDay() === 0;
          const dayCopy = new Date(day); dayCopy.setHours(0,0,0,0);
          const isPast = dayCopy.getTime() < today.getTime();

          dayEl.innerHTML = `
            <div class="font-semibold">${getDayName(day)}</div>
            <div class="text-sm text-gray-600">${day.getDate()}</div>
          `;

          if (isSunday || isPast) {
            dayEl.classList.add('disabled');
            dayEl.title = isSunday ? 'No disponible (domingo)' : 'No disponible (fecha pasada)';
          } else {
            dayEl.classList.add('cursor-pointer','hover:bg-gray-100');
            if (selectedDay && isSameDay(selectedDay, day)) dayEl.classList.add('active');
            dayEl.addEventListener('click', () => {
              document.querySelectorAll('.day').forEach(el => el.classList.remove('active'));
              dayEl.classList.add('active');
              selectDay(day);
            });
          }

          daysContainer.appendChild(dayEl);
        });

        if (selectedDay) generateTimeSlots(selectedDay);
      }

      async function generateTimeSlots(date) {
        timeSlotsContainer.innerHTML = '';
        const dateKey = formatDate(date, true); // YYYY-MM-DD

        const res = await fetch(`/api/availability?date=${dateKey}`);
        const data = await res.json();
        const available = data.slots || [];

        if (!available.length) {
          const msg = document.createElement('div');
          msg.className = 'col-span-full text-center text-sm text-gray-500 py-2';
          msg.textContent = 'No hay horarios disponibles para este d√≠a.';
          timeSlotsContainer.appendChild(msg);
          return;
        }

        available.forEach(time => {
          const slotEl = document.createElement('div');
          slotEl.className = 'p-3 border rounded-md text-center font-medium time-slot available hover:bg-blue-100';
          slotEl.textContent = time;
          slotEl.addEventListener('click', () => selectTime(date, time));

          if (selectedTime && selectedTime.time === time && isSameDay(selectedTime.date, date)) {
            slotEl.classList.add('selected');
          }
          timeSlotsContainer.appendChild(slotEl);
        });
      }


      function selectDay(day) {
        selectedDay = day;
        selectedTime = null;
        generateTimeSlots(day);
        hideConfirmation();
      }

      function selectTime(date, time) {
        selectedTime = { date, time };
        document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
        [...timeSlotsContainer.children].find(el => el.textContent === time).classList.add('selected');
        showConfirmation();
      }

      function showConfirmation() {
        confirmationSection.classList.remove('opacity-0','invisible','h-0');
        confirmationSection.classList.add('opacity-100','visible','h-auto');

        confirmNameElement.textContent = `${(nombreInput.value || '')} ${(apellidoInput.value || '')}`.trim();
        confirmDateElement.textContent = selectedTime ? formatDate(selectedTime.date) : '';
        confirmTimeElement.textContent = selectedTime ? selectedTime.time : '';

        const ready = !!(selectedTime && nombreInput.value.trim() && apellidoInput.value.trim());
        confirmBtn.disabled = !ready;
        confirmBtn.classList.toggle('btn-disabled', !ready);
        confirmBtn.textContent = ready ? 'Reservar turno' : 'Completa los datos para reservar';
      }

      function hideConfirmation() {
        confirmationSection.classList.remove('opacity-100','visible','h-auto');
        confirmationSection.classList.add('opacity-0','invisible','h-0');
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Completa los datos para reservar';
        confirmBtn.classList.add('btn-disabled');
      }

      function formatDate(date, forKey = false) {
        if (forKey) {
          return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
        }
        const options = { day: 'numeric', month: 'long' };
        return new Intl.DateTimeFormat('es-ES', options).format(date);
      }

      function getDayName(date) {
        const options = { weekday: 'long' };
        return new Intl.DateTimeFormat('es-ES', options).format(date);
      }

      prevWeekBtn.addEventListener('click', () => {
        if (currentWeek > 0) {
          currentWeek--;
          selectedDay = null; selectedTime = null;
          hideConfirmation();
          generateWeekDays();
        }
      });
      nextWeekBtn.addEventListener('click', () => {
        currentWeek++;
        selectedDay = null; selectedTime = null;
        hideConfirmation();
        generateWeekDays();
      });

      nombreInput.addEventListener('input', () => { if (selectedTime) showConfirmation(); });
      apellidoInput.addEventListener('input', () => { if (selectedTime) showConfirmation(); });

      confirmBtn.addEventListener('click', async () => {
        if (!selectedTime) return;

        const payload = {
          nombre: nombreInput.value.trim(),
          apellido: apellidoInput.value.trim(),
          date: formatDate(selectedTime.date, true),
          time: selectedTime.time
        };

        confirmBtn.disabled = true;

        const res = await fetch('/api/book', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        confirmBtn.disabled = false;

        if (res.ok) {
          successMessage.classList.remove('hidden');
          // limpiar selecci√≥n de horario y refrescar
          selectedTime = null;
          showConfirmation();
          generateTimeSlots(selectedDay);
          setTimeout(() => successMessage.classList.add('hidden'), 4000);
        } else {
          const { error } = await res.json();
          alert(error || 'No se pudo reservar. Prob√° con otro horario.');
          generateTimeSlots(selectedDay);
        }
      });
      generateWeekDays();
    });
  </script>
</body>
</html>
